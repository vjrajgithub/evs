var $={get:function(t){for(var e=document.querySelectorAll(t),i=0;i<e.length;i++)this.init(e[i]);return e},template:function(t){var e=document.createElement("div");return e.innerHTML=t.trim(),this.init(e.childNodes[0])},init:function(t){return t.on=function(t,e){this.addEventListener(t,e)},t}},drop=function(t){var e={options:t.options,selected:t.selected||[],preselected:t.preselected||[],open:!1,html:{select:$.get(t.selector)[0],options:$.get(t.selector+" option"),parent:void 0},init:function(){this.html.parent=$.get(t.selector)[0].parentNode,this.html.drop=$.template('<div class="drop"></div>'),this.html.dropDisplay=$.template('<div class="drop-display">Display</div>'),this.html.dropOptions=$.template('<div class="drop-options">Options</div>'),this.html.dropScreen=$.template('<div class="drop-screen"></div>'),this.html.parent.insertBefore(this.html.drop,this.html.select),this.html.drop.appendChild(this.html.dropDisplay),this.html.drop.appendChild(this.html.dropOptions),this.html.drop.appendChild(this.html.dropScreen),this.html.drop.appendChild(this.html.select);var e=this;this.html.dropDisplay.on("click",function(){e.toggle()}),this.html.dropScreen.on("click",function(){e.toggle()}),this.load(),this.preselect(),this.render()},toggle:function(){this.html.drop.classList.toggle("open")},addOption:function(t,e){var i=Number(e.dataset.index);this.clearStates(),this.selected.push({index:Number(i),state:"add",removed:!1}),this.options[i].state="remove",this.render()},removeOption:function(t,e){t.stopPropagation(),this.clearStates();var i=Number(e.dataset.index);this.selected.forEach(function(t){t.index!=i||t.removed||(t.removed=!0,t.state="remove")}),this.options[i].state="add",this.render()},load:function(){this.options=[];for(var t=0;t<this.html.options.length;t++){var e=this.html.options[t];this.options[t]={html:e.innerHTML,value:e.value,selected:e.selected,state:""}}},preselect:function(){var t=this;this.selected=[],this.preselected.forEach(function(e){t.selected.push({index:e,state:"add",removed:!1}),t.options[e].state="remove"})},render:function(){this.renderDrop(),this.renderOptions()},renderDrop:function(){var t=this,e=$.template("<div></div>");this.selected.forEach(function(i,s){var n=t.options[i.index],o=$.template('<span class="item '+i.state+'">'+n.html+"</span>"),r=$.template('<i class="material-icons btnclose" data-index="'+i.index+'">&#xe5c9;</i></span>');r.on("click",function(e){t.removeOption(e,this)}),o.appendChild(r),e.appendChild(o)}),this.html.dropDisplay.innerHTML="",this.html.dropDisplay.appendChild(e)},renderOptions:function(){var t=this,e=$.template("<div></div>");this.options.forEach(function(i,s){var n=$.template('<a data-index="'+s+'" class="'+i.state+'">'+i.html+"</a>");n.on("click",function(e){t.addOption(e,this)}),e.appendChild(n)}),this.html.dropOptions.innerHTML="",this.html.dropOptions.appendChild(e)},clearStates:function(){var t=this;this.selected.forEach(function(e,i){e.state=t.changeState(e.state)}),this.options.forEach(function(e){e.state=t.changeState(e.state)})},changeState:function(t){switch(t){case"remove":case"hide":return"hide";default:return""}},isSelected:function(t){var e=!1;return this.selected.forEach(function(i){i.index==t&&0==i.removed&&(e=!0)}),e}};return e.init(),e},options=[{html:"cats",value:"cats"},{html:"fish",value:"fish"},{html:"squids",value:"squids"},{html:"cats",value:"whales"},{html:"cats",value:"bikes"}],myDrop=new drop({selector:"#type_of_check",preselected:[0,2]});myDrop.toggle();